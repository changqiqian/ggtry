{"version":3,"sources":["file:///Users/yamiwang/cowboy/assets/scripts/base/DataNotify.ts"],"names":["DataNotify","__listeners","__properties","__defaultValues","__created","RemoveListenerByProp","_prop","_target","console","log","i","configs","length","target","splice","_getValue","_propName","hasOwnProperty","after","_update","_val","listener","before","forEach","lis","undefined","callback","call","AddListener","propertyName","push","RemoveListenerByTarget","key","Step","ClearListeners","CreateNotify","props","Object","keys","propertyDefine","prop","str","toString","includes","get","set","val","defineProperties","reset","resetDataToDefault","DefaultValue"],"mappings":"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","sourcesContent":["\nexport class DataNotify \n{\n\n    __listeners = {};\n    __properties = {};\n    __defaultValues = {};\n    __created = false;\n\n    _getValue(_propName)\n    {\n        if(this.__listeners.hasOwnProperty(_propName))\n        {\n            return this.__listeners[_propName].after;\n        }\n\n        return this.__properties[_propName];\n    }\n\n    _update(_propName, _val)\n    {\n        this.__properties[_propName] = _val;\n        if(!this.__listeners.hasOwnProperty(_propName)) return;\n        var listener = this.__listeners[_propName];\n        let before = listener.before;\n        listener.after = listener.before = _val;\n        listener.configs.forEach((lis)=>\n        {\n            if(_val !== null && _val !== undefined)\n            {\n                lis.callback.call(lis.target, _val, before)\n            }\n        });\n    }\n\n\n    AddListener(propertyName, callback, target)\n    {\n        if(this.__listeners.hasOwnProperty(propertyName))\n        {\n            this.__listeners[propertyName].configs.push(\n            {\n                callback : callback,\n                target : target\n            });\n        }\n        else\n        {\n            this.__listeners[propertyName] = \n            {\n                configs : \n                [{\n                    callback : callback,\n                    target : target\n                }],\n                before : this[propertyName],\n                after : this[propertyName]\n            }\n        }\n\n        if(this[propertyName] != null && this[propertyName] != undefined && callback && target)\n        {\n            callback.call(target, this[propertyName], null);\n        }\n    }\n\n    RemoveListenerByTarget(target)\n    {\n        if(!target)\n        {\n            console.log(\"缺少必要参数target\");\n            return\n        }\n    \n        for(var key in this.__listeners)\n        {\n            var Step = 0;\n            while(this.__listeners[key].configs.length >0 && Step < this.__listeners[key].configs.length)\n            {\n                if(this.__listeners[key].configs[Step].target == target)\n                {\n                    this.__listeners[key].configs.splice(Step, 1);\n                    Step = 0;\n                }\n                else\n                {\n                    Step++;\n                }\n            }\n        }\n    }\n\n    RemoveListenerByProp = function(_prop, _target)\n    {\n        if(!_target || !_prop)\n        {\n            console.log(\"缺少必要参数\");\n            return\n        }\n\n        for(var i=0; i<this.__listeners[_prop].configs.length; i++)\n        {\n            if(this.__listeners[_prop].configs[i].target == _target)\n            {\n                this.__listeners[_prop].configs.splice(i, 1);\n            }\n        }\n    }\n\n    ClearListeners()\n    {\n        this.__listeners = null;\n        this.__listeners = {};\n    }\n\n    CreateNotify()\n    {\n        if(this.__created) return;\n        var props = Object.keys(this);\n        var propertyDefine = {};\n        props.forEach((prop)=>\n        {\n            let str = prop.toString();\n            if(str.includes(\"Data_\"))\n            {\n                this.__properties[prop] = this[prop];\n                this.__defaultValues[prop] = this[prop];\n                propertyDefine[prop] = \n                {\n                    get()\n                    { \n                        return this._getValue(prop) \n                    },\n                    set(val)\n                    { \n                        this._update(prop, val);\n                    }\n                }\n            }\n        });\n        Object.defineProperties(this, propertyDefine);\n\n        this.__created = true;\n    }\n\n\n    reset()\n    {\n        this.resetDataToDefault();\n        this.ClearListeners();\n    }\n\n    resetDataToDefault()\n    {\n        var props = Object.keys(this);\n        props.forEach((prop) => \n        {\n            let str = prop.toString();\n            if(str.includes(\"Data_\"))\n            {\n                var DefaultValue  =this.__defaultValues[prop];\n                this[prop]  = DefaultValue;\n            }\n        })\n    }\n}\n\n"]}