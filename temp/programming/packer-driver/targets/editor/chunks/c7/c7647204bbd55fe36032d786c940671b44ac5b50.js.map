{"version":3,"sources":["file:///Users/yamiwang/cowboy/assets/scripts/base/DataNotify.ts"],"names":["DataNotify","__listeners","__properties","__defaultValues","__created","RemoveListenerByProp","_prop","_target","console","log","i","configs","length","target","splice","_getValue","_propName","hasOwnProperty","after","_update","_val","listener","before","forEach","lis","undefined","callback","call","_tryBindArrayFunction","Array","arrProto","Object","create","prototype","self","method","defineProperty","value","result","apply","arguments","__proto__","AddListener","propertyName","push","RemoveListenerByTarget","key","Step","ClearListeners","CreateNotify","props","keys","propertyDefine","prop","get","set","val","defineProperties","toJSONObject","reset","resetDataToDefault","DefaultValue"],"mappings":"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","sourcesContent":["\nexport class DataNotify \n{\n    __listeners = {};\n    __properties = {};\n    __defaultValues = {};\n    __created = false;\n\n    _getValue(_propName)\n    {\n        if(this.__listeners.hasOwnProperty(_propName))\n        {\n            return this.__listeners[_propName].after;\n        }\n\n        return this.__properties[_propName];\n    }\n\n    _update(_propName, _val)\n    {\n        this.__properties[_propName] = _val;\n        if(!this.__listeners.hasOwnProperty(_propName)) return;\n        var listener = this.__listeners[_propName];\n        let before = listener.before;\n        listener.after = listener.before = _val;\n        listener.configs.forEach((lis)=>\n        {\n            if(_val !== null && _val !== undefined)\n            {\n                lis.callback.call(lis.target, _val, before)\n            }\n        });\n    }\n\n    _tryBindArrayFunction(_propName) \n    {\n        if (this[_propName] instanceof Array) \n        {\n            var arrProto = Object.create(Array.prototype);\n            var self = this;\n            ['shift','unshift','push','pop','splice'].forEach((method) =>\n            {\n                Object.defineProperty(arrProto, method,{\n                    value: function(){\n                        var result = Array.prototype[method].apply(this, arguments);\n                        self._update(_propName, self[_propName])\n                        return result;\n                    }\n                })\n            })\n            this[_propName].__proto__ = arrProto\n        } \n    }\n\n    AddListener(propertyName, callback, target)\n    {\n        if(this.__listeners.hasOwnProperty(propertyName))\n        {\n            this.__listeners[propertyName].configs.push(\n            {\n                callback : callback,\n                target : target\n            });\n        }\n        else\n        {\n            this.__listeners[propertyName] = \n            {\n                configs : \n                [{\n                    callback : callback,\n                    target : target\n                }],\n                before : this[propertyName],\n                after : this[propertyName]\n            }\n        }\n\n        if(this[propertyName] != null && this[propertyName] != undefined && callback && target)\n        {\n            callback.call(target, this[propertyName], null);\n        }\n    }\n\n    RemoveListenerByTarget(target)\n    {\n        if(!target){\n            console.log(\"缺少必要参数target\");\n            return\n        }\n    \n        for(var key in this.__listeners)\n        {\n            var Step = 0;\n            while(this.__listeners[key].configs.length >0 && Step < this.__listeners[key].configs.length)\n            {\n                if(this.__listeners[key].configs[Step].target == target)\n                {\n                    this.__listeners[key].configs.splice(Step, 1);\n                    Step = 0;\n                }\n                else\n                {\n                    Step++;\n                }\n            }\n        }\n    }\n\n    RemoveListenerByProp = function(_prop, _target)\n    {\n        if(!_target || !_prop)\n        {\n            console.log(\"缺少必要参数\");\n            return\n        }\n\n        for(var i=0; i<this.__listeners[_prop].configs.length; i++)\n        {\n            if(this.__listeners[_prop].configs[i].target == _target)\n            {\n                this.__listeners[_prop].configs.splice(i, 1);\n            }\n        }\n    }\n\n    ClearListeners()\n    {\n        this.__listeners = null;\n        this.__listeners = {};\n    }\n\n    CreateNotify()\n    {\n        if(this.__created) return;\n\n        var props = Object.keys(this);\n        var propertyDefine = {};\n        props.forEach((prop)=>\n        {\n            this.__properties[prop] = this[prop];\n            this.__defaultValues[prop] = this[prop];\n            this._tryBindArrayFunction(prop);\n            propertyDefine[prop] = \n            {\n                get()\n                { \n                    return this._getValue(prop) \n                },\n                set(val)\n                { \n                    this._update(prop, val);\n                }\n            }\n        });\n        Object.defineProperties(this, propertyDefine);\n\n        this.__created = true;\n    }\n\n    toJSONObject()\n    {\n        var props = Object.keys(this);\n        var result = {};\n        props.forEach((prop) => \n        {\n            result[prop] = this[prop];\n        })\n        return result;\n    }\n\n    reset()\n    {\n        this.resetDataToDefault();\n        this.ClearListeners();\n    }\n\n    resetDataToDefault()\n    {\n        var props = Object.keys(this);\n        props.forEach((prop) => \n        {\n            var DefaultValue  =this.__defaultValues[prop];\n            if(typeof DefaultValue == \"function\")\n            {\n\n            }\n            else\n            {\n                if(\"__listeners\" == prop)\n                {\n\n                }\n                else\n                {\n                    this[prop]  = DefaultValue;\n                }\n            }\n        })\n    }\n}\n\n"]}