{"version":3,"sources":["file:///Users/yamiwang/cowboy/assets/scripts/base/DataNotify.ts"],"names":["DataNotify","__listeners","__properties","__defaultValues","__created","RemoveListenerByProp","_prop","_target","console","log","i","configs","length","target","splice","GetInstance","__ins","CreateNotify","_getValue","_propName","hasOwnProperty","after","_update","_val","listener","before","forEach","lis","undefined","callback","call","AddListener","propertyName","push","RemoveListenerByTarget","key","Step","ClearListeners","props","Object","keys","propertyDefine","prop","str","toString","includes","get","set","val","defineProperties","toJSONObject","result","reset","resetDataToDefault","DefaultValue"],"mappings":"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","sourcesContent":["\nexport class DataNotify \n{\n    public static __ins:DataNotify = null;\n\n    public static GetInstance() : DataNotify\n    {\n        if(DataNotify.__ins == null)\n        {\n            DataNotify.__ins = new DataNotify();\n            DataNotify.__ins.CreateNotify();\n        }\n\n        return DataNotify.__ins;\n    }\n    \n\n\n\n    __listeners = {};\n    __properties = {};\n    __defaultValues = {};\n    __created = false;\n\n    _getValue(_propName)\n    {\n        if(this.__listeners.hasOwnProperty(_propName))\n        {\n            return this.__listeners[_propName].after;\n        }\n\n        return this.__properties[_propName];\n    }\n\n    _update(_propName, _val)\n    {\n        this.__properties[_propName] = _val;\n        if(!this.__listeners.hasOwnProperty(_propName)) return;\n        var listener = this.__listeners[_propName];\n        let before = listener.before;\n        listener.after = listener.before = _val;\n        listener.configs.forEach((lis)=>\n        {\n            if(_val !== null && _val !== undefined)\n            {\n                lis.callback.call(lis.target, _val, before)\n            }\n        });\n    }\n\n\n    AddListener(propertyName, callback, target)\n    {\n        if(this.__listeners.hasOwnProperty(propertyName))\n        {\n            this.__listeners[propertyName].configs.push(\n            {\n                callback : callback,\n                target : target\n            });\n        }\n        else\n        {\n            this.__listeners[propertyName] = \n            {\n                configs : \n                [{\n                    callback : callback,\n                    target : target\n                }],\n                before : this[propertyName],\n                after : this[propertyName]\n            }\n        }\n\n        if(this[propertyName] != null && this[propertyName] != undefined && callback && target)\n        {\n            callback.call(target, this[propertyName], null);\n        }\n    }\n\n    RemoveListenerByTarget(target)\n    {\n        if(!target){\n            console.log(\"缺少必要参数target\");\n            return\n        }\n    \n        for(var key in this.__listeners)\n        {\n            var Step = 0;\n            while(this.__listeners[key].configs.length >0 && Step < this.__listeners[key].configs.length)\n            {\n                if(this.__listeners[key].configs[Step].target == target)\n                {\n                    this.__listeners[key].configs.splice(Step, 1);\n                    Step = 0;\n                }\n                else\n                {\n                    Step++;\n                }\n            }\n        }\n    }\n\n    RemoveListenerByProp = function(_prop, _target)\n    {\n        if(!_target || !_prop)\n        {\n            console.log(\"缺少必要参数\");\n            return\n        }\n\n        for(var i=0; i<this.__listeners[_prop].configs.length; i++)\n        {\n            if(this.__listeners[_prop].configs[i].target == _target)\n            {\n                this.__listeners[_prop].configs.splice(i, 1);\n            }\n        }\n    }\n\n    ClearListeners()\n    {\n        this.__listeners = null;\n        this.__listeners = {};\n    }\n\n    CreateNotify()\n    {\n        if(this.__created) return;\n        var props = Object.keys(this);\n        console.log(\"props=====\" + props);\n        var propertyDefine = {};\n        props.forEach((prop)=>\n        {\n            console.log(\"prop=====\" + prop);\n            let str = prop.toString();\n            if(str.includes(\"Data_\"))\n            {\n                console.log(\"str=====\" + str);\n                this.__properties[prop] = this[prop];\n                this.__defaultValues[prop] = this[prop];\n                propertyDefine[prop] = \n                {\n                    get()\n                    { \n                        return this._getValue(prop) \n                    },\n                    set(val)\n                    { \n                        this._update(prop, val);\n                    }\n                }\n            }\n        });\n        Object.defineProperties(this, propertyDefine);\n\n        this.__created = true;\n    }\n\n    toJSONObject()\n    {\n        var props = Object.keys(this);\n        var result = {};\n        props.forEach((prop) => \n        {\n            result[prop] = this[prop];\n        })\n        return result;\n    }\n\n    reset()\n    {\n        this.resetDataToDefault();\n        this.ClearListeners();\n    }\n\n    resetDataToDefault()\n    {\n        var props = Object.keys(this);\n        props.forEach((prop) => \n        {\n            var DefaultValue  =this.__defaultValues[prop];\n            if(typeof DefaultValue == \"function\")\n            {\n\n            }\n            else\n            {\n                if(\"__listeners\" == prop)\n                {\n\n                }\n                else\n                {\n                    this[prop]  = DefaultValue;\n                }\n            }\n        })\n    }\n}\n\n"]}