{"version":3,"sources":["file:///Users/yamiwang/cowboy/assets/scripts/base/DataNotify.ts"],"names":["DataNotify","GetInstance","__ins","constructor","__listeners","__properties","__defaultValues","__created","RemoveListenerByProp","_prop","_target","console","log","i","configs","length","target","splice","CreateNotify","_getValue","_propName","hasOwnProperty","after","_update","_val","listener","before","forEach","lis","undefined","callback","call","AddListener","propertyName","push","RemoveListenerByTarget","key","Step","ClearListeners","props","Object","keys","propertyDefine","prop","str","toString","includes","get","set","val","defineProperties","toJSONObject","result","reset","resetDataToDefault","DefaultValue"],"mappings":"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","sourcesContent":["\nexport class DataNotify \n{\n    public static __ins:DataNotify = null;\n\n    public static GetInstance() : DataNotify\n    {\n        if(DataNotify.__ins == null)\n        {\n            DataNotify.__ins = new DataNotify();\n        }\n\n        return DataNotify.__ins;\n    }\n    \n    constructor()\n    {\n        this.CreateNotify();\n    }\n    \n\n\n    __listeners = {};\n    __properties = {};\n    __defaultValues = {};\n    __created = false;\n\n    _getValue(_propName)\n    {\n        if(this.__listeners.hasOwnProperty(_propName))\n        {\n            return this.__listeners[_propName].after;\n        }\n\n        return this.__properties[_propName];\n    }\n\n    _update(_propName, _val)\n    {\n        this.__properties[_propName] = _val;\n        if(!this.__listeners.hasOwnProperty(_propName)) return;\n        var listener = this.__listeners[_propName];\n        let before = listener.before;\n        listener.after = listener.before = _val;\n        listener.configs.forEach((lis)=>\n        {\n            if(_val !== null && _val !== undefined)\n            {\n                lis.callback.call(lis.target, _val, before)\n            }\n        });\n    }\n\n\n    AddListener(propertyName, callback, target)\n    {\n        if(this.__listeners.hasOwnProperty(propertyName))\n        {\n            this.__listeners[propertyName].configs.push(\n            {\n                callback : callback,\n                target : target\n            });\n        }\n        else\n        {\n            this.__listeners[propertyName] = \n            {\n                configs : \n                [{\n                    callback : callback,\n                    target : target\n                }],\n                before : this[propertyName],\n                after : this[propertyName]\n            }\n        }\n\n        if(this[propertyName] != null && this[propertyName] != undefined && callback && target)\n        {\n            callback.call(target, this[propertyName], null);\n        }\n    }\n\n    RemoveListenerByTarget(target)\n    {\n        if(!target){\n            console.log(\"缺少必要参数target\");\n            return\n        }\n    \n        for(var key in this.__listeners)\n        {\n            var Step = 0;\n            while(this.__listeners[key].configs.length >0 && Step < this.__listeners[key].configs.length)\n            {\n                if(this.__listeners[key].configs[Step].target == target)\n                {\n                    this.__listeners[key].configs.splice(Step, 1);\n                    Step = 0;\n                }\n                else\n                {\n                    Step++;\n                }\n            }\n        }\n    }\n\n    RemoveListenerByProp = function(_prop, _target)\n    {\n        if(!_target || !_prop)\n        {\n            console.log(\"缺少必要参数\");\n            return\n        }\n\n        for(var i=0; i<this.__listeners[_prop].configs.length; i++)\n        {\n            if(this.__listeners[_prop].configs[i].target == _target)\n            {\n                this.__listeners[_prop].configs.splice(i, 1);\n            }\n        }\n    }\n\n    ClearListeners()\n    {\n        this.__listeners = null;\n        this.__listeners = {};\n    }\n\n    CreateNotify()\n    {\n        if(this.__created) return;\n        var props = Object.keys(this);\n        var propertyDefine = {};\n        props.forEach((prop)=>\n        {\n            console.log(\"prop=====\" + prop);\n            let str = prop.toString();\n            if(str.includes(\"Data_\"))\n            {\n                console.log(\"str=====\" + str);\n                this.__properties[prop] = this[prop];\n                this.__defaultValues[prop] = this[prop];\n                propertyDefine[prop] = \n                {\n                    get()\n                    { \n                        return this._getValue(prop) \n                    },\n                    set(val)\n                    { \n                        this._update(prop, val);\n                    }\n                }\n            }\n        });\n        Object.defineProperties(this, propertyDefine);\n\n        this.__created = true;\n    }\n\n    toJSONObject()\n    {\n        var props = Object.keys(this);\n        var result = {};\n        props.forEach((prop) => \n        {\n            result[prop] = this[prop];\n        })\n        return result;\n    }\n\n    reset()\n    {\n        this.resetDataToDefault();\n        this.ClearListeners();\n    }\n\n    resetDataToDefault()\n    {\n        var props = Object.keys(this);\n        props.forEach((prop) => \n        {\n            var DefaultValue  =this.__defaultValues[prop];\n            if(typeof DefaultValue == \"function\")\n            {\n\n            }\n            else\n            {\n                if(\"__listeners\" == prop)\n                {\n\n                }\n                else\n                {\n                    this[prop]  = DefaultValue;\n                }\n            }\n        })\n    }\n}\n\n"]}